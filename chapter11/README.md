# Chapter 11. 컴포넌트 성능 최적화

## 느려지는 현상

이전 예제에 2500개의 데이터를 삽입하고 관찰한 결과 `Toggle` 시 리렌더링이 상당히 느려짐.

### 리렌더링이 발생하는 경우

1. 자신이 전달받은 `props`가 변경되었을 때
2. 자신의 `state`가 바뀔 때
3. 부모 컴포넌트가 리렌더링될 때
4. `forceUpdate` 함수가 실행될 때

### 느려지는 원인

- 할 일 `state`인 `todos`를 `App`컴포넌트가 관리하고 있고, `state`가 변경되면서 `App` 컴포넌트가 리렌더링되고 모든 하위 컴포넌트들이 리렌더링됨.
- `onRemove`, `onToggle`, `onInsert` 함수가 `todos`를 참조하면서, `todos`가 변경될 때 마다 함수가 다시 생성됨.

### 해결책

- `shouldComponentUpdate` 라이프사이클 사용.
- 함수형 컴포넌트는 `React.memo` 사용.
- `useState`의 `setTodos`에 새로운 상태를 파라미터로 넣는 대신, 상태 업데이트를 어떻게 할지 정의하는 함수를 넣음.
- 이를 함수형 업데이트라고 함.
- 혹은 `useReducer`를 이용할 수 있음.

## 불변성의 중요성

### 불변성 유지

값을 직접 수정하지 않고 새로운 값을 맨들어 내는 것.

- `map()`, `filter()`, `concat()` 등 사용하여 기존 값을 직접 수정하는 것이 아니라 새로운 값을 만들어 내는 것.

## react-virtualized
- 2500개 컴포넌트 중 대부분은 스크롤하기 전에는 보이지도 않음.
- 스크롤하기 전에는 크기만 차지하고 스크롤한 후 렌더링해주는 라이브러리.
- `react 17` 이상에서는 아래 명령어로 설치
  ```
    npm install react-virtualized --legacy-peer-deps
  ```
